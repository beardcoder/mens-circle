---
import Base from '@/layouts/Base.astro'

const token = Astro.params.token
const cmsUrl = import.meta.env.CMS_URL || 'http://localhost:3001'

let message = ''
let success = false

if (token) {
  try {
    const res = await fetch(`${cmsUrl}/api/unsubscribe/${token}`)
    const data = await res.json()
    message = data.message || data.error
    success = data.success
  } catch {
    message = 'Ein Fehler ist aufgetreten.'
  }
}
---

<Base title="Newsletter abmelden">
  <section class="hero" style="min-height: 60vh;">
    <div class="hero__bg"></div>
    <div class="container">
      <div class="hero__content">
        <h1 class="hero__title"><span class="hero__title-line">Newsletter</span></h1>
        <div class="hero__bottom">
          <p class="hero__description">{message}</p>
          {success && (
            <div class="hero__cta fade-in-delay-1">
              <a href="/" class="btn btn--primary btn--large">Zur√ºck zur Startseite</a>
            </div>
          )}
        </div>
      </div>
    </div>
  </section>
</Base>
