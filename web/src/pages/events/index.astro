---
import Base from '@/layouts/Base.astro';
import { getUpcomingEvents, getPastEvents } from '@/lib/payload';

const upcoming = await getUpcomingEvents();
const past = await getPastEvents();

const formatDate = (dateStr: string) => {
  const d = new Date(dateStr);
  return {
    weekday: d.toLocaleDateString('de-DE', { weekday: 'long' }),
    date: d.toLocaleDateString('de-DE', { day: '2-digit', month: 'long', year: 'numeric' }),
    short: d.toLocaleDateString('de-DE'),
  };
};
---

<Base title="Veranstaltungen" description="Alle Treffen des Männerkreis Niederbayern/Straubing – kommende und vergangene Termine.">
  <section class="hero">
    <div class="hero__bg"></div>
    <div class="hero__circles" aria-hidden="true">
      <div class="hero__circle hero__circle--1"></div>
      <div class="hero__circle hero__circle--2"></div>
    </div>
    <div class="container">
      <div class="hero__content">
        <p class="hero__label">Männerkreis</p>
        <h1 class="hero__title"><span class="hero__title-line">Veranstaltungen</span></h1>
        <div class="hero__bottom">
          <p class="hero__description">
            Finde das nächste Treffen und melde dich an.
          </p>
        </div>
      </div>
    </div>
  </section>

  <section class="events-list-section">
    <div class="container">
      {upcoming.length > 0 ? (
        <>
          <div class="events-list__header fade-in">
            <p class="eyebrow">Kommende Termine</p>
            <h2 class="section-title">Nächste <span class="text-italic">Treffen</span></h2>
          </div>
          <div class="events-list__grid stagger-children">
            {upcoming.map((event) => {
              const d = formatDate(event.eventDate);
              return (
                <a href={`/event/${event.slug}`} class="event-card fade-in">
                  <div class="event-card__date">
                    <span class="event-card__weekday">{d.weekday}</span>
                    <span class="event-card__date-str">{d.date}</span>
                  </div>
                  <div class="event-card__info">
                    <h3 class="event-card__title">{event.title}</h3>
                    <p class="event-card__meta">
                      {event.startTime} – {event.endTime} Uhr · {event.location}{event.city ? `, ${event.city}` : ''}
                    </p>
                    <p class="event-card__basis">{event.costBasis}</p>
                  </div>
                  <span class="event-card__arrow" aria-hidden="true">&rarr;</span>
                </a>
              );
            })}
          </div>
        </>
      ) : (
        <div class="events-list__empty fade-in">
          <p class="eyebrow">Aktuell</p>
          <h2 class="section-title">Derzeit keine <span class="text-italic">Termine</span></h2>
          <p class="events-list__empty-text">
            Momentan sind keine Treffen geplant. Melde dich für unseren Newsletter an, um über neue Termine informiert zu werden.
          </p>
          <a href="/#newsletter" class="btn btn--primary btn--large">Newsletter abonnieren</a>
        </div>
      )}

      {past.length > 0 && (
        <div class="events-list__past fade-in">
          <div class="events-list__header">
            <p class="eyebrow">Rückblick</p>
            <h2 class="section-title">Vergangene <span class="text-italic">Treffen</span></h2>
          </div>
          <div class="events-list__grid stagger-children">
            {past.map((event) => {
              const d = formatDate(event.eventDate);
              return (
                <a href={`/event/${event.slug}`} class="event-card event-card--past fade-in">
                  <div class="event-card__date">
                    <span class="event-card__weekday">{d.weekday}</span>
                    <span class="event-card__date-str">{d.date}</span>
                  </div>
                  <div class="event-card__info">
                    <h3 class="event-card__title">{event.title}</h3>
                    <p class="event-card__meta">
                      {event.startTime} – {event.endTime} Uhr · {event.location}
                    </p>
                  </div>
                </a>
              );
            })}
          </div>
        </div>
      )}
    </div>
  </section>
</Base>

<style>
  .events-list-section {
    padding: var(--space-2xl) 0;
  }

  .events-list__header {
    margin-block-end: var(--space-xl);
  }

  .events-list__grid {
    display: grid;
    gap: var(--space-md);
  }

  .event-card {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding: var(--space-lg);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .event-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px oklch(0% 0 0 / 0.08);
  }

  .event-card--past {
    opacity: 0.7;
  }

  .event-card__date {
    display: flex;
    flex-direction: column;
    min-inline-size: 8rem;
    text-align: center;
    padding: var(--space-sm) var(--space-md);
    background: oklch(from var(--color-primary) l c h / 0.08);
    border-radius: var(--radius-md);
  }

  .event-card__weekday {
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-primary);
  }

  .event-card__date-str {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .event-card__info {
    flex: 1;
  }

  .event-card__title {
    font-size: var(--text-lg);
    margin: 0 0 var(--space-xs);
  }

  .event-card__meta {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .event-card__basis {
    font-size: var(--text-sm);
    color: var(--color-primary);
    margin: var(--space-xs) 0 0;
  }

  .event-card__arrow {
    font-size: var(--text-xl);
    color: var(--color-primary);
    transition: transform 0.2s;
  }

  .event-card:hover .event-card__arrow {
    transform: translateX(4px);
  }

  .events-list__empty {
    text-align: center;
    padding: var(--space-2xl) 0;
  }

  .events-list__empty-text {
    max-inline-size: 40rem;
    margin-inline: auto;
    margin-block-end: var(--space-lg);
    color: var(--color-text-secondary);
  }

  .events-list__past {
    margin-block-start: var(--space-2xl);
    padding-block-start: var(--space-2xl);
    border-block-start: 1px solid oklch(0% 0 0 / 0.08);
  }

  @media (max-width: 640px) {
    .event-card {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-md);
    }

    .event-card__date {
      min-inline-size: auto;
    }

    .event-card__arrow {
      display: none;
    }
  }
</style>
