# NOTE: This is a reference/optional Caddyfile
# By default, Laravel Octane uses its own built-in Caddyfile with worker support
# If you want to use this custom Caddyfile, update supervisord.conf to include:
# --caddyfile=/app/Caddyfile
#
# This file is kept for reference and can be customized as needed

{
	frankenphp {
		worker {
			file /app/public/frankenphp-worker.php
			num {$FRANKENPHP_WORKERS:2}
		}
	}
}

:8080 {
	root * /app/public

	encode zstd br gzip

	@static {
		file
		path *.js *.css *.jpg *.jpeg *.gif *.png *.ico *.cur *.gz *.svg *.svgz *.mp4 *.mp3 *.ogg *.ogv *.webm *.htc *.woff2 *.woff *.avif
	}

	@staticshort {
		file
		path *.json *.xml *.rss
	}

	# 1 year cache for immutable assets
	header @static Cache-Control "public, immutable, stale-while-revalidate, max-age=31536000"

	# 1 hour cache with validation
	header @staticshort Cache-Control "no-cache, max-age=3600"

	# Restrict access to sensitive files
	@rejected {
		path *.bak *.conf *.dist *.fla *.ini *.inc *.inci *.log *.orig *.psd *.sh *.sql *.swo *.swp *.swop
		not path /.well-known/*
	}
	respond @rejected 403

	php_server {
		resolve_root_symlink
	}
}
