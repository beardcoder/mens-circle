# Asset caching configuration
# Included via /etc/nginx/server-opts.d/

# Immutable assets (Vite hashed files) - 1 year cache
location ~* ^/build/assets/.*\.(js|css|woff2?|ttf|eot|otf)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# Images and media in build directory - 1 year cache
location ~* ^/build/.*\.(jpg|jpeg|png|gif|ico|svg|webp|avif|mp4|webm|mp3|ogg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# Static assets in public directory - 1 month cache with revalidation
location ~* ^/(?!build/).*\.(jpg|jpeg|png|gif|ico|svg|webp|avif|cur)$ {
    expires 30d;
    add_header Cache-Control "public, max-age=2592000, stale-while-revalidate=86400";
    access_log off;
}

# Fonts in public directory - 1 year cache
location ~* ^/(?!build/).*\.(woff2?|ttf|eot|otf)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# JSON/XML files - short cache with revalidation
location ~* \.(json|xml|rss)$ {
    expires 1h;
    add_header Cache-Control "no-cache, max-age=3600";
}

# Favicon - 1 week cache
location = /favicon.ico {
    expires 7d;
    add_header Cache-Control "public, max-age=604800";
    access_log off;
    log_not_found off;
}

# Robots.txt - short cache
location = /robots.txt {
    expires 1d;
    add_header Cache-Control "public, max-age=86400";
    access_log off;
    log_not_found off;
}

# Security: deny access to sensitive files
location ~* \.(bak|conf|dist|fla|ini|inc|log|orig|psd|sh|sql|swo|swp)$ {
    return 404;
}

location ~ /\. {
    return 404;
}
